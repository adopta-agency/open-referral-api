<?php$route = '/users/';$app->post($route, function ()  use ($app,$allow_ips,$salt){  	$ReturnObject = array(); 	$request = $app->request();	$_GET = $request->params();	$REMOTE_ADDR = $_SERVER['REMOTE_ADDR'];	if (strpos($allow_ips, $REMOTE_ADDR) !== false) 		{		$clean = filter_input_array(INPUT_POST,$_GET);		if(isset($clean['name'])){ $name = $clean['name']; } else { $name = '';}		if(isset($clean['email'])){ $email = $clean['email']; } else { $email = '';}		if(isset($clean['github_id'])){ $github_id = $clean['github_id']; } else { $github_id = '';}		if(isset($clean['github_login'])){ $github_login = $clean['github_login']; } else { $github_login = '';}		$user_key = encrypt($email,$salt);		if($name!='')			{								$Query = "SELECT * FROM users WHERE email = '" . $email . "'";			//echo $Query;			$Database = mysql_query($Query) or die('Query failed: ' . mysql_error());					if($Database && mysql_num_rows($Database))				{				$users = mysql_fetch_assoc($Database);									$ReturnObject['id'] = $users['id'];				$ReturnObject['name'] = $users['name'];				$ReturnObject['email'] = $users['email'];				$ReturnObject['github_id'] = $users['github_id'];				$ReturnObject['github_login'] = $users['github_login'];				$ReturnObject['user_key'] = $users['user_key'];								$AppQuery = "SELECT * FROM apps WHERE user_id = '" . $users['id'] . "' and name LIKE '%Default%'";				//echo $AppQuery;				$AppResults = mysql_query($AppQuery) or die('Query failed: ' . mysql_error());							if($AppResults && mysql_num_rows($AppResults))					{					$App = mysql_fetch_assoc($AppResults);									$ReturnObject['app_key'] = $App['app_key'];					}				else 					{
					$ReturnObject['app_key'] = 'none';
					}						}			else				{										// Add A New User						$user_id = getGUID();										$InsertQuery = "INSERT INTO users(";							$InsertQuery .= "id,";				$InsertQuery .= "name,";				$InsertQuery .= "email,";				$InsertQuery .= "github_id,";				$InsertQuery .= "github_login,";				$InsertQuery .= "user_key";							$InsertQuery .= ") VALUES(";							$InsertQuery .= "'" . mysql_real_escape_string($user_id) . "',";				$InsertQuery .= "'" . mysql_real_escape_string($name) . "',";				$InsertQuery .= "'" . mysql_real_escape_string($email) . "',";				$InsertQuery .= "'" . mysql_real_escape_string($github_id) . "',";				$InsertQuery .= "'" . mysql_real_escape_string($github_login) . "',";				$InsertQuery .= "'" . mysql_real_escape_string($user_key) . "'";							$InsertQuery .= ")";								//echo $InsertQuery;				mysql_query($InsertQuery) or die('Query failed: ' . mysql_error());									$ReturnObject['id'] = $user_id;				$ReturnObject['name'] = $name;				$ReturnObject['email'] = $email;				$ReturnObject['github_id'] = $github_id;				$ReturnObject['github_login'] = $github_login;					$ReturnObject['user_key'] = $user_key;											// Let's Add A Default App				$app_name = $name . " default app";				$app_name = ucwords($app_name);										$app_id = getGUID();				$app_key = encrypt($app_name,$salt);										$InsertQuery = "INSERT INTO apps(";							$InsertQuery .= "id,";				$InsertQuery .= "name,";				$InsertQuery .= "user_id,";				$InsertQuery .= "app_key";							$InsertQuery .= ") VALUES(";							$InsertQuery .= "'" . mysql_real_escape_string($app_id) . "',";				$InsertQuery .= "'" . mysql_real_escape_string($app_name) . "',";				$InsertQuery .= "'" . mysql_real_escape_string($user_id) . "',";				$InsertQuery .= "'" . mysql_real_escape_string($app_key) . "'";				$InsertQuery .= ")";								echo $InsertQuery;				mysql_query($InsertQuery) or die('Query failed: ' . mysql_error());									$ReturnObject['app_key'] = $app_key;											}				}		}			$app->response()->header("Content-Type", "application/json");	echo stripslashes(format_json(json_encode($ReturnObject)));	});?>